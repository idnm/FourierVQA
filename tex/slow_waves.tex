\documentclass[12 pt]{article}
\usepackage[utf8x]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{empheq}
\usepackage[sort&compress,numbers]{natbib}
\usepackage{doi}
\usepackage{esvect}
\usepackage{cancel}
\usepackage{braket}
\usepackage{hyperref}
\hypersetup{
	colorlinks   = true, %Colours links instead of ugly boxes
	urlcolor     = blue, %Colour for external hyperlinks
	linkcolor    = blue, %Colour of internal links
	citecolor   = red %Colour of citations
}

\textheight 23cm
\textwidth 18cm
\voffset=-1.2in
\hoffset= - 0.9in         
\begin{document}
\tableofcontents
\section{Notation}
\begin{itemize}
\item $n$ - number of qubits
\item $M$ - number of parameters
\item
\begin{align}
	f_i(\phi)=\cos^{1-i}\phi\,\,\sin^i\phi=\begin{cases} \cos\phi,\quad i=0\\\sin\phi,\quad i=1\end{cases}
\end{align}
\item
\begin{align}
	f_I(\phi)=\prod_{m=1}^M f_{I_m}(\phi_m)
\end{align}
\end{itemize}
\section{PQC}
Parametrized circuit with $M$ parameters
\begin{align}
	U(\phi)=\sum_{I\in [0,1]^M}U_I f_I\left(\frac{\phi}{2}\right)
\end{align}
where $U_I = U(\phi=\pi I)$. E.g. for $M=2$
\begin{align}U_{00}\cos\frac{\phi_1}{2}\cos\frac{\phi_2}{2}+U_{01}\cos\frac{\phi_1}{2}\sin\frac{\phi_2}{2}+U_{10}\sin\frac{\phi_1}{2}\cos\frac{\phi_2}{2}+U_{11}\sin\frac{\phi_1}{2}\sin\frac{\phi_2}{2}
\end{align}
\section{Quadratic loss and its Fourier expansion}
Quadratic loss function
\begin{align}
	L(\phi)=\Braket{0|U(\phi)^\dagger H U(\phi)|0}
\end{align}
can be expanded as
\begin{align}
	L(\phi)=\sum_{I,J} f_I\left(\frac{\phi}{2}\right)f_J\left(\frac{\phi}{2}\right)\Braket{0|U_I^\dagger H U_J|0}=\sum_{m=0}^M L_m(\phi)
\end{align}
where
\begin{align}
&L_0(\phi) = const\\
&L_1(\phi)=\sum_{i=0}^M L_{i}(\phi_i)\\
&L_2(\phi)=\sum_{i<j=0}^M L_{ij}(\phi_i, \phi_j)\\
&L_3(\phi)=\sum_{i<j<k=0}^M L_{ijk}(\phi_i, \phi_j,\phi_k)\\
&L_4(\phi)=\dots
\end{align}
And each summand in each term is is a homogeneous trigonometric polynomial of a special form
\begin{align}
	&L(\phi_1)=A\cos\phi_1+B\sin\phi_1\\
	&L(\phi_1,\phi_2)=A\cos\phi_1\cos\phi_2+B\cos{\phi_1}\sin{\phi_2}+C\sin{\phi_1}\cos{\phi_2}+D\sin{\phi_1}\sin{\phi_2}\\
	&L(\phi_1,\phi_2,\phi_3)=A\cos{\phi_1}\cos{\phi_2}\cos{\phi_3}+\dots
\end{align}
\section{Coefficients in Fourier expansion from averages} \label{Fourier from averages}
Note that 
\begin{align}
F_0=\Braket{L(\phi)}_\phi=\frac1{(2\pi)^M}\int_0^{2\pi}\prod_i^M d\phi_i\,\, L(\phi)=\frac1{2^M}\sum_{I\in [0, 1]^M} L(\phi=\pi I)=\frac1{2^M}\sum_{I\in [0,1]^M}\Braket{0|U_I^\dagger H U_I|0}\label{F0}
\end{align}
where to get the last expression we used $\int_0^{2\pi} \prod_i^Md\phi_i\,\, f_I(\phi)f_J(\phi)=\pi^M \delta_{IJ}$. Similarly,
\begin{align}
&F_i(\phi_i)=\Braket{L(\phi)-L_0}_{\phi\neq\phi_i}\\	&F_{ij}(\phi_i,\phi_j)=\Braket{L(\phi)-L_1(\phi)-L_0}_{\phi\neq \phi_i,\phi_j}\\
&F_{ijk}(\phi_i,\phi_j,\phi_k)=\dots
\end{align}
\section{Averages for Clifford+$\phi$ circuits} \label{clifford averages}
For a general circuit computing the average requires $2^M$ evaluations of the loss function. For a class of circuits that consists only of Clifford gates and Pauli rotations computing averages can be done very efficiently.

Introduce
\begin{align}
	U_m=U(\phi_m=\pi)=C'_m P_m C''_m=P_m' C 
\end{align}
Here $P_m$ is the Pauli gate corresponding to $m$-th parameter, $C'_m$ and $C''_m$ are Clifford gates to the right and left from the Pauli rotation, $C=C'_mC''_m=U(\phi=0)$ is the total Clifford of the circuit and $P'_m$ is the Pauli gate of parameter $m$ commuted to the rightmost.

Let $P'$ be the the Pauli subgroup generated by $\mathbb{I}$ and all $P'_m$. The average \eqref{F0} can be rewritten as
\begin{align}
F_0=\frac1{2^M}\sum_{P\in P'}\Braket{0|C^\dagger PHPC|0}
\end{align}
Now let $H$ itself be a Pauli string $Q$. Then $PQP=(-)^{QP}Q$ 
\begin{align}
F_0=\frac1{2^M}\sum_{P\in P'}(-)^{PQ}\Braket{0|C^\dagger Q C|0}
\end{align}
Now, if there is an element in $P'$ such that $(-)^{PQ}=-1$ the whole sum is necessarily zero. Therefore
\begin{align}
F_0=\begin{cases}\Braket{0|C^\dagger Q C|0},\quad \text{if } [P', Q]=0\\0,\quad \text{otherwise}\end{cases}
\end{align}
\section{Fourier expansion of Clifford+$\phi$ loss functions}
Define 
\begin{align}
	\widehat{F}_H(\phi)=U^\dagger(\phi)HU(\phi)
\end{align}
We will assume that the loss function is a linear combination of Pauli strings $H=\sum_i c_i Q_i$, hence
\begin{align}
	\widehat{F}_{H}(\phi)=\sum c_i \widehat{F}_{Q_i}(\phi)
\end{align}
and focus on a single term $\widehat{F}_Q(\phi)$.

Next, we will assume that there are no Clifford gates in the circuit, only Pauli rotations. This is no loss of generality, since every Clifford gate can be commuted to the end of the circuit and absorbed into a redefinition of $Q$. Therefore, the circuit we have is (note product in reverse order)
\begin{align}
	U(\phi)=\prod_{m=M}^0 e^{i P_m \frac{\phi_m}{2}}
\end{align}
Next we note that
\begin{align}
	e^{-\frac12iP\phi}Qe^{\frac12iP\phi}=\begin{cases}
	Q,\quad PQ=QP\\ Q\cos\phi + iQP\sin\phi,\quad PQ=-QP
	\end{cases}
\end{align}
We can use this relation to expand $\widehat{F}_Q(\phi)$ recursively. When $Q$ is sandwiched between the commuting Pauli rotations nothing happens and the corresponding angle is simply omitted. When $Q$ encounters an anti-commuting Pauli rotation a split occurs, and the order of Fourier terms increases.

Let the of the computation be
\begin{align}
	\widehat{F}_Q(\phi)=\sum_s Q_s f_{I_s}(\phi)
\end{align}
where the sum is over non-trivial splits. We first note several properties of this expansion
\begin{itemize}
	\item There can be at most $2^M$ terms, in case a split occurs each time.
	\item The following weighted sum is invariant
	\begin{align}
		\sum_s 2^{M-|s|}=2^M
	\end{align}
	For example, if the is a term with $|s|=0$ splits (corresponding to the lowest Fourier mode) no other terms are present in the expansion. If there is a term with a single split $|s|=1$ there can be at most $2^{M}/2$ other terms, etc.
\end{itemize}
\section{Fourier expansion as approximation}
Now consider the loss function $F_Q(\phi)=\Braket{0|\widehat{F}_Q(\phi)|0}$ and its $L^2$ norm
\begin{align}
	F_Q=\sum_s \Braket{0|Q_s|0} f_{I_s}(\phi)\\
	||F_Q(\phi)||^2=\frac{1}{(2\pi)^M}\int \prod_{i=1^M}d\phi_i|F_Q(\phi)|^2=\sum_s 2^{-|s|}|\Braket{0|Q_s|0}|^2  \label{L2 norm}
\end{align}
The last equation follows the fact that all $f_{I_s}$ are orthogonal and satisfy $||f_{I_s}(\phi)||^2=2^{-|s|}$.
Thus, the lower the order of the Fourier mode the mode it contributes to the $L^2$ norm of $F_Q(\phi)$, provided the corresponding coefficient $\braket{0|Q_s|0}$ is non-zero.

It follows from \eqref{L2 norm} that the norm of $F_Q(\phi)$ is bounded 
\begin{align}
	||F_Q(\phi)||^2\le 1
\end{align}
and the bound is saturated if all matrix elements $\braket{0|Q_s|0}$ are non-zero. Eq. \eqref{L2 norm} also shows that generally Fourier terms of the lower order contribute exponentially more. Hence the is a possibility that restricting to lower order Fourier terms one can obtain good approximation of the loss function. Although we can not guarantee to get a good approximation in advance, we can control and improve the bound during the computation.

For example, assume we found a term with a single split. We can then bound the remaining norm by $||\delta F||\le\frac12$. If the term has non-zero coefficient, we have already accounted for $50\%$ of the norm! 

So, it would be very interesting to experiment with these things and see if it is possible to get a good approximation in practice.
\section{Algorithms and data structure}
We can visualize computation of the Fourier expansion as a tree. The root corresponds to the original circuit and is described by a sequence of Pauli matrices $P_M\dots P_1$ and an observable $Q$. Branching corresponds to hitting an anticommuting Pauli rotation. A branch terminates if no Pauli rotations are left. The computation is simply the construction of such a tree. We can define two strategies for doing that.

\textbf{Level expansion.} At each iteration we branch from all of the existing non-terminal nodes. This corresponds to going one level up in the Fourier expansion.

\textbf{Greedy expansion.} At each iteration we branch only from the node with the smallest number of Pauli rotations left.

\section{Simple random model}
To accounts for the full Fourier series we need exponentially many terms, $2^M$. A question is how many parameters do we need in practice to get a good approximation? Let us try to introduce a simple probabilistic model to make estimates.

We assume that $M$ Pauli rotations $P_1,\dots, P_M$ are chosen at random, a so is $Q$. Then, the probability of $Q$ commuting or anti-commuting with either of $P_i$ is $\frac12$. We now ask, what is the average number of terms $n_{m,M}$ at each level $m$ for an $M$ parameter circuit? The following simple recurrence relation holds
\begin{align}
	n_{m,M+1}=\frac12 n_{m, M}+n_{m-1,M}
\end{align}
When we add an additional $P_{M+1}$, with probability $\frac12$ it commutes with $Q$ and the number of terms is the same as for the sequence without $P_{M+1}$. If $P_{M+1}$ anti-commutes with $Q$ we instead get two subtrees with $M$ parameters where we need to check how many terms are at level $m-1$. The solution to this recurrence equation is
\begin{align}
	n_{m,M}=2^{m-M} C_M^m 
\end{align}
The total average number of terms
\begin{align}
	n_M=\sum_{m=0}^Mn_{n,m}=\left(\frac32\right)^M
\end{align}
It is less that the maximal number $2^M$ but still exponential. Since the norm per term decreases as $2^{-m}$ the average contribution to the norm per level is given by
\begin{align}
	\nu_{m,M}=2^{-M}C_M^m,\quad \sum_{m=0}^M\nu_{m,M}=1
\end{align}
Because $C_M^m$ is a symmetric function wrt $m\to M-m$ it is clear that to account for $50\%$ of the norm we need to include $\sim m\sim \frac{M}{2}$ Fourier orders. How many Fourier terms will that include? I'm not sure about exact asymptotic, but roughly
\begin{align}
	n_{\frac{M}{2},M}\sim \sqrt{2}^M
\end{align}
In the large $M$ limit this is an exponentially small fraction of all parameters, yet containing exponentially many terms.

\end{document}
